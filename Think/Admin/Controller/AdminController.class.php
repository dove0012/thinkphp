<?phpnamespace Admin\Controller;use Common\Controller\CommonController;class AdminController extends CommonController {        public function _initialize() {        $this->model = D('Admin');    }        public function take() {        exit(json_encode($this->model->get_alladmin()));    }        public function add_admin() {        if ($_POST) {            $roleIds = $_POST['role_id'];            if (!$this->model->create()) {                $this->error($this->model->getError());            }            $id = $this->model->add();            if ($id) {                foreach ($roleIds as $k => $v) {                    $data[$k]['role_id'] = $v;                    $data[$k]['user_id'] = $id;                }                $this->model = M('role_user');                $this->model->table(C('DB_PREFIX') . 'role_user')->addAll($data) ? $this->success('添加成功!') : $this->success('添加管理员成功,添加角色失败!');            } else {                $this->error('添加失败!');            }        } else {            $this->assign('role', $this->model->table(C('DB_PREFIX') . 'role')->select());            $this->display();        }    }        public function del_admin($id) {        $this->model->where('id=' . $id)->delete() ? $this->success('删除用户成功!') : $this->error('删除用户失败!');    }    	public function edit_myself() {		$id = session('authId');		if ($_POST) {			$_POST['id'] = $id;			if ($_POST['password']) {				$pw = $this->model->where('id=' . $id)->getField('password');				if ($pw == md5($_POST['password'])) {					$_POST['password'] = $_POST['repassword'];				} else {					$this->error('密码不正确!');				}			}            if (!$this->model->create()) {                $this->error($this->model->getError());            }            $this->model->save() ? $this->success('编辑成功!') : $this->error('编辑失败!');		} else {            $this->assign('res', $this->model->where('id=' . $id)->find());            $role = $this->model->table(C('DB_PREFIX') . 'role')->select();            $role_user = $this->model->table(C('DB_PREFIX') . 'role_user')->where('user_id=' . $id)->select();            foreach ($role as $k => $v) {                foreach ($role_user as $x) {                    if ($x['role_id'] == $v['id'])                        $role[$k]['checked'] = 1;                }            }            $this->assign('role', $role);            $this->display('add_admin');        }	}        public function edit_admin($id = 0) {        if ($_POST) {            $_POST['id'] = session(__URL__ . '_edit_id');            $roleIds = $_POST['role_id'];            if (!$this->model->create()) {                $this->error($this->model->getError());            }            $res = $this->model->save();            if ($res) {                $this->model = M('role_user');                if ($this->model->where('user_id=' . $_POST['id'])->find()) {                    if (!$this->model->where('user_id=' . $_POST['id'])->delete())                        $this->error('删除旧的角色失败!');                }                session(__URL__ . '_edit_id', null);                if ($roleIds) {                    foreach ($roleIds as $k => $v) {                        $data[$k]['role_id'] = $v;                        $data[$k]['user_id'] = $_POST['id'];                    }                    $this->model->table(C('DB_PREFIX') . 'role_user')->addAll($data) ? $this->success('编辑成功!') : $this->success('编辑管理员成功,编辑角色失败!');                }                $this->success('编辑成功!');            } else {                $this->error('编辑失败!');            }        } else {            session(__URL__ . '_edit_id', $id); //记录要编辑的ID            $this->assign('res', $this->model->where('id=' . $id)->find());            $role = $this->model->table(C('DB_PREFIX') . 'role')->select();            $role_user = $this->model->table(C('DB_PREFIX') . 'role_user')->where('user_id=' . $id)->select();            foreach ($role as $k => $v) {                foreach ($role_user as $x) {                    if ($x['role_id'] == $v['id'])                        $role[$k]['checked'] = 1;                }            }            $this->assign('role', $role);            $this->display('add_admin');        }    }        public function edit_value() {        $value = $_POST['value'] == 1 ? 1 : 0;        $data[$_POST['type']] = $value;        $this->model->where('id=' . $_POST['id'])->save($data) ? $this->success() : $this->error();    }}