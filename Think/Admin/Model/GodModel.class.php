<?phpnamespace Admin\Model;use Think\Model\RelationModel;class GodModel extends RelationModel {    protected $_validate = array(        array('member_id', 'require', '会员id不能为空!'), //默认情况下用正则进行验证    );    protected $_auto = array (         array('create_time', 'time', 1, 'function'), // 对create_time字段在创建的时候写入当前时间戳        array('update_time', 'time', 3, 'function'), // 对update_time字段在所有情况都写入当前时间戳    );    public function take($condition='all') {        $where = $condition == 'all' ? '' : $this->tablePrefix."god.status='".intval($condition)."'";        $order = $this->tablePrefix.'god.create_time desc';        return $this->field($this->tablePrefix.'member_info.*,'.$this->tablePrefix.'god.*')->join('__MEMBER_INFO__ ON __GOD__.member_id = __MEMBER_INFO__.member_id')->where($where)->order($order)->mSelect();    }    public function apply($data) {        $godData = $this->where('member_id=%d', array($data['member_id']))->order('create_time desc')->find();        if ($godData['status'] == 0) {            $this->error = '您已经申请过了,请耐心等待审核!';            return false;        } elseif ($godData['status'] == 1) {            $this->error = '您已经是游神了,请勿再次申请!';            return false;        }        $i['member_id'] = $data['member_id'];        if (!$this->create($i)) {            return false;        }        $this->startTrans();        if ($this->add()) {            $model = D('Admin/Member');            if ($model->memberInfo($data)) {                $this->commit();                return true;            } else {                $this->rollback();                $this->error = $model->getError();                return false;            }        } else {            $this->rollback();            $this->error = '申请失败!';            return false;        }    }    public function checkApply($data){        $this->startTrans();        $i['status'] = $data['status'] == 1 ? '1' : '2';        $i['remark'] = trim($data['remark']);        $i['update_time'] = time();        if ($this->where("id=%d", array($data['id']))->save($i) !== false) {            $is_god = $data['status'] == 1 ? '1' : '0';            if (M('memberInfo')->where('member_id=%d', array($data['member_id']))->save(array('is_god'=>$is_god)) !== false) {                $this->commit();                return true;            }        }        $this->rollback();        $this->error = '操作失败!';        return false;    }}